#========================================================================
# build and deployment of TESTING configuration
#========================================================================
-
  os: Visual Studio 2015
  
  init:
    - git config --global core.autocrlf true
  
  environment:
    Environment: Debug

  # Install scripts. (runs after repo cloning)
  install:
    - git remote set-url origin https://github.com/daleholborow/iayos.flashcards.suomi.git
    # Get the latest stable version of Node.js or io.js
    - ps: Install-Product node ''
    #- npm -g install npm@2
    - set PATH=%APPDATA%\npm;%PATH%;
    # Install global modules
    #- npm install -g gulp --skip-installed          # Gulp so we can perform build-time gulp calls to MSBuild task. Skip installation if already in cache
    - cd frontend    
    - npm install -g gulp typings --skip-installed
    - npm install --skip-installed
    - cd ..  
 
 # Post-install test scripts.
  test_script:
    # Output useful info for debugging.
    - node --version
    - npm --version
    ## run tests
    #- npm test
  
#  nuget:
#    account_feed: true  
  
  branches:
    only:
      - develop
      - master
      - /feature.*/   # You can use Regex expression to match multiple branch name(s)

  configuration: Debug
  
  #platform: Any CPU

  # Retain NuGet, Bower & NPM package caches between builds.  
  cache:
    - '%LocalAppData%\bower\cache\packages'		# Preserve Bower packages (note LOCAL not ROAMING location)
    - '%APPDATA%\npm-cache'
    - frontend\node_modules -> C:\projects\iayos-flashcards-suomi\frontend\package.json
    - frontend\typings -> C:\projects\iayos-flashcards-suomi\frontend\typings.json


  # We are NOT building a VS solution, so try to switch to build_script mode
  build_script:
    # Run Gulp build on frontend site.
    - cd frontend
    - typings install
    - gulp build
    - cd ..
    
  artifacts:
    - path: frontend\app\
      name: final-app-ui

  deploy:
    -
      provider: Environment
      name: iayos.flashcards.suomi

